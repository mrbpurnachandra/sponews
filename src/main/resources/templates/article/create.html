<!DOCTYPE html>
<html lang="en" xmlns="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<head>
    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css"
    />
    <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>

<div class="container mt-4" layout:fragment="content">
    <h3 class="display-6">लेख रचना गर्नुहोस्</h3>
    <form id="article-form" th:action="@{/article}" th:object="${article}" method="post" class="mt-4">
        <div class="mb-3">
            <label for="title" class="form-label visually-hidden">शीर्षक</label>
            <p th:if="${#fields.hasErrors('title')}" class="text-danger">शीर्षक कम्तिमा 4 अक्षर लामो हुनुपर्छ</p>
            <input class="form-control" th:field="*{title}" placeholder="शीर्षक">
        </div>
        <div class="mb-3">
            <label for="content" class="form-label visually-hidden">सामग्री</label>
            <p th:if="${#fields.hasErrors('content')}" class="text-danger">सामग्री कम्तिमा 64 र अधिकतम 2048 अक्षर लामो हुनुपर्छ</p>
            <input type="hidden" th:field="*{content}">
            <textarea id="content-editor" aria-label="input"></textarea>
        </div>

        <div>
            <button type="submit" class="btn btn-primary">प्रकाशित गर्नुहोस्</button>
        </div>
    </form>

    <script>
        var simplemde = new SimpleMDE({
            toolbar: [
                "bold",
                "italic",
                "strikethrough",
                "|",
                "quote",
                "|",
                "ordered-list",
                "unordered-list",
                "|",
                "heading-2",
                "heading-3",
                "|",
                "image",
                "|",
                "preview",
            ],

            element: document.getElementById("content-editor"),
        });

        const articleForm = document.getElementById("article-form");

        articleForm.addEventListener("submit", function (event) {
            event.preventDefault();
            const content = marked.parse(simplemde.value());

            if(content.length < 64 || content.length > 2048) {
                alert("सामग्री कम्तिमा 64 र बढीमा 2048 अक्षर लामो हुनुपर्छ")
                return;
            }

            const contentInput = document.getElementById("content");
            contentInput.value = content;

            event.target.submit();
        });

    </script>
</div>

</body>
</html>